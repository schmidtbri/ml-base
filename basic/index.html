
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="ML Base Package Documentation">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.10">
    
    
      
        <title>Introducing the ml_base Package - ML Base</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d6be258b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introducing-the-ml_base-package" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ML Base" class="md-header__button md-logo" aria-label="ML Base" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ML Base
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Introducing the ml_base Package
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/schmidtbri/ml-base/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ML Base" class="md-nav__button md-logo" aria-label="ML Base" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ML Base
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/schmidtbri/ml-base/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Basic Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Basic Examples
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-a-simple-model" class="md-nav__link">
    Creating a Simple Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-wrapper-class-for-your-model" class="md-nav__link">
    Creating a Wrapper Class for Your Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-an-mlmodel-class-for-your-model" class="md-nav__link">
    Creating an MLModel Class for Your Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-schemas-to-your-model" class="md-nav__link">
    Adding Schemas to Your Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-modelmanager-class" class="md-nav__link">
    Using the ModelManager Class
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../decorator/" class="md-nav__link">
        Decorator Examples
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-a-simple-model" class="md-nav__link">
    Creating a Simple Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-wrapper-class-for-your-model" class="md-nav__link">
    Creating a Wrapper Class for Your Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-an-mlmodel-class-for-your-model" class="md-nav__link">
    Creating an MLModel Class for Your Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-schemas-to-your-model" class="md-nav__link">
    Adding Schemas to Your Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-modelmanager-class" class="md-nav__link">
    Using the ModelManager Class
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/schmidtbri/ml-base/edit/master/docs/basic.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="introducing-the-ml_base-package">Introducing the ml_base Package</h1>
<p>These examples run within an Jupyter notebook session. To clear out the results of cells that we don't want to see we'll use the clear_output() function provided by Jupyter:</p>
<pre><code class="language-python">from IPython.display import clear_output
</code></pre>
<p>To get started we'll install the ml_base package:</p>
<pre><code class="language-python">!pip install ml_base

clear_output()
</code></pre>
<h2 id="creating-a-simple-model">Creating a Simple Model</h2>
<p>To show how to work with the MLModel base class we'll create a simple model that we can make predictions with. We'll use the scikit-learn library, so we'll need to install it:</p>
<pre><code class="language-python">!pip install scikit-learn

clear_output()
</code></pre>
<p>Now we can write some code to train a model:</p>
<pre><code class="language-python">from sklearn import datasets
from sklearn import svm
import pickle

# loading the Iris dataset
iris = datasets.load_iris()

# instantiating an SVM model from scikit-learn
svm_model = svm.SVC(gamma=1.0, C=1.0)

# fitting the model
svm_model.fit(iris.data[:-1], iris.target[:-1])

# serializing the model and saving it
file = open(&quot;svc_model.pickle&quot;, 'wb')
pickle.dump(svm_model, file)
file.close()
</code></pre>
<h2 id="creating-a-wrapper-class-for-your-model">Creating a Wrapper Class for Your Model</h2>
<p>Now that we have a model object, we'll define a class that implements the prediction functionality for the code:</p>
<pre><code class="language-python">import os
from numpy import array


class IrisModel(object):
    def __init__(self):
        dir_path = os.path.abspath('')
        file = open(os.path.join(dir_path, &quot;svc_model.pickle&quot;), 'rb')
        self._svm_model = pickle.load(file)
        file.close()

    def predict(self, data: dict):
        X = array([data[&quot;sepal_length&quot;], data[&quot;sepal_width&quot;], data[&quot;petal_length&quot;], data[&quot;petal_width&quot;]]).reshape(1, -1)
        y_hat = int(self._svm_model.predict(X)[0])
        targets = ['setosa', 'versicolor', 'virginica']
        species = targets[y_hat]
        return {&quot;species&quot;: species}
</code></pre>
<p>The class above wraps the pickled model object and makes the model easier to use by converting the inputs and outputs.
To use the model, all we need to do is this:</p>
<pre><code class="language-python">model = IrisModel()

prediction = model.predict(data={
    &quot;sepal_length&quot;:1.0,
    &quot;sepal_width&quot;:1.1,
    &quot;petal_length&quot;: 1.2,
    &quot;petal_width&quot;: 1.3})

prediction
</code></pre>
<pre><code>{'species': 'virginica'}
</code></pre>
<h2 id="creating-an-mlmodel-class-for-your-model">Creating an MLModel Class for Your Model</h2>
<p>The model is already much easier to use because it provides the prediction from a class. The user of the model doesn't
need to worry about loading the pickled model object, or converting the model's input into a numpy array. However, we
are still not using the MLModel abstract base class, now we'll implement a part of the MLModel's interface to show how
it works:</p>
<pre><code class="language-python">from ml_base import MLModel


class IrisModel(MLModel):
    @property
    def display_name(self):
        return &quot;Iris Model&quot;

    @property
    def qualified_name(self):
        return &quot;iris_model&quot;

    @property
    def description(self):
        return &quot;A model to predict the species of a flower based on its measurements.&quot;

    @property
    def version(self):
        return &quot;1.0.0&quot;

    @property
    def input_schema(self):
        raise NotImplementedError()

    @property
    def output_schema(self):
        raise NotImplementedError()

    def __init__(self):
        dir_path = os.path.abspath('')
        file = open(os.path.join(dir_path, &quot;svc_model.pickle&quot;), 'rb')
        self._svm_model = pickle.load(file)
        file.close()

    def predict(self, data: dict):
        X = array([data[&quot;sepal_length&quot;], data[&quot;sepal_width&quot;], data[&quot;petal_length&quot;], data[&quot;petal_width&quot;]]).reshape(1, -1)
        y_hat = int(self._svm_model.predict(X)[0])
        targets = ['setosa', 'versicolor', 'virginica']
        species = targets[y_hat]
        return {&quot;species&quot;: species}
</code></pre>
<p>The MLModel base class defines a set of properties that must be provided by any class that inherits from it. Because the IrisModel class now provides this metadata about the model, we can access it directly from the model object like this:</p>
<pre><code class="language-python">model = IrisModel()

print(model.qualified_name)
</code></pre>
<pre><code>iris_model
</code></pre>
<p>The qualified name of the model uniquely identifies the instance of the model within the system. Right now the qualified name is hardcoded in the code of the model's class, but this can be made more dynamic in the future. The qualified name should also be a string that is easy to embed in a URL, so it shouldn't have spaces or special characters.</p>
<p>The model's display name is also available from the model object:</p>
<pre><code class="language-python">print(model.display_name)
</code></pre>
<pre><code>Iris Model
</code></pre>
<p>The display name of a model should be a string that looks good in a user interface.</p>
<p>The model description is also available from the model object:</p>
<pre><code class="language-python">print(model.description)
</code></pre>
<pre><code>A model to predict the species of a flower based on its measurements.
</code></pre>
<p>The model version is also available as a string from the model object:</p>
<pre><code class="language-python">print(model.version)
</code></pre>
<pre><code>1.0.0
</code></pre>
<p>As you can see, we didn't implement the input_schema and output_schema properties above, we'll add those next.</p>
<h2 id="adding-schemas-to-your-model">Adding Schemas to Your Model</h2>
<p>To add schema information to the model class, we'll use the pydantic package. The pydantic package allows us to state the schema requirements of the model's input and output programatically as Python classes:</p>
<pre><code class="language-python">from pydantic import BaseModel, Field
from pydantic import ValidationError
from enum import Enum


class ModelInput(BaseModel):
    sepal_length: float = Field(gt=5.0, lt=8.0, description=&quot;The length of the sepal of the flower.&quot;)
    sepal_width: float = Field(gt=2.0, lt=6.0, description=&quot;The width of the sepal of the flower.&quot;)
    petal_length: float = Field(gt=1.0, lt=6.8, description=&quot;The length of the petal of the flower.&quot;)
    petal_width: float = Field(gt=0.0, lt=3.0, description=&quot;The width of the petal of the flower.&quot;)


class Species(str, Enum):
    iris_setosa = &quot;Iris setosa&quot;
    iris_versicolor = &quot;Iris versicolor&quot;
    iris_virginica = &quot;Iris virginica&quot;


class ModelOutput(BaseModel):
    species: Species = Field(description=&quot;The predicted species of the flower.&quot;)

</code></pre>
<p>The ModelInput class inherits from the pydantic BaseModel class and it defines four required fields, all of them floating point numbers. The pydantic package allows for defining upper bounds and lower bounds for the values accepted by each field, and also a description for the field.</p>
<p>The ModelOutput is made up of a single fields, which is an enumerated string that contains the predicted species of the flower.</p>
<p>Now that we have the ModelInput and ModelOutput schemas defined as pydantic BaseModel classes, we'll add them to the IrisModel class by returning them from the input_schema and output_schema properties:</p>
<pre><code class="language-python">from ml_base.ml_model import MLModel, MLModelSchemaValidationException


class IrisModel(MLModel):
    @property
    def display_name(self):
        return &quot;Iris Model&quot;

    @property
    def qualified_name(self):
        return &quot;iris_model&quot;

    @property
    def description(self):
        return &quot;A model to predict the species of a flower based on its measurements.&quot;

    @property
    def version(self):
        return &quot;1.0.0&quot;

    @property
    def input_schema(self):
        return ModelInput

    @property
    def output_schema(self):
        return ModelOutput

    def __init__(self):
        dir_path = os.path.abspath('')
        with open(os.path.join(dir_path, &quot;svc_model.pickle&quot;), 'rb') as f:
            self._svm_model = pickle.load(f)

    def predict(self, data: ModelInput):
        # creating a numpy array using the fields in the input object
        X = array([data.sepal_length, 
                   data.sepal_width, 
                   data.petal_length, 
                   data.petal_width]).reshape(1, -1)

        # making a prediction, at this point its a number
        y_hat = int(self._svm_model.predict(X)[0])

        # converting the prediction from a number to a string
        targets = [&quot;Iris setosa&quot;, &quot;Iris versicolor&quot;, &quot;Iris virginica&quot;]
        species = targets[y_hat]

        # returning the prediction inside an object
        return ModelOutput(species=species)
</code></pre>
<p>Notice that we are also using the pydantic models to validate the input before prediction and to
create an object that will be returned from the model's predict() method.</p>
<p>If we use the model class now, we'll get this result:</p>
<pre><code class="language-python">model = IrisModel()

prediction = model.predict(ModelInput(
    sepal_length=6.0, 
    sepal_width=2.1, 
    petal_length=1.2, 
    petal_width=1.3))

prediction
</code></pre>
<pre><code>ModelOutput(species=&lt;Species.iris_virginica: 'Iris virginica'&gt;)
</code></pre>
<p>By adding input and output schemas to the model, we can automate many other operations later. Also, we can query
the model object itself for the schema. The pydantic package is able to create JSON schema from the fields in the input and output schema objects of the model:</p>
<pre><code class="language-python">model = IrisModel()

model.input_schema.schema()
</code></pre>
<pre><code>{'title': 'ModelInput',
 'type': 'object',
 'properties': {'sepal_length': {'title': 'Sepal Length',
   'description': 'The length of the sepal of the flower.',
   'exclusiveMinimum': 5.0,
   'exclusiveMaximum': 8.0,
   'type': 'number'},
  'sepal_width': {'title': 'Sepal Width',
   'description': 'The width of the sepal of the flower.',
   'exclusiveMinimum': 2.0,
   'exclusiveMaximum': 6.0,
   'type': 'number'},
  'petal_length': {'title': 'Petal Length',
   'description': 'The length of the petal of the flower.',
   'exclusiveMinimum': 1.0,
   'exclusiveMaximum': 6.8,
   'type': 'number'},
  'petal_width': {'title': 'Petal Width',
   'description': 'The width of the petal of the flower.',
   'exclusiveMinimum': 0.0,
   'exclusiveMaximum': 3.0,
   'type': 'number'}},
 'required': ['sepal_length', 'sepal_width', 'petal_length', 'petal_width']}
</code></pre>
<pre><code class="language-python">model.output_schema.schema()
</code></pre>
<pre><code>{'title': 'ModelOutput',
 'type': 'object',
 'properties': {'species': {'$ref': '#/definitions/Species'}},
 'required': ['species'],
 'definitions': {'Species': {'title': 'Species',
   'description': 'An enumeration.',
   'enum': ['Iris setosa', 'Iris versicolor', 'Iris virginica'],
   'type': 'string'}}}
</code></pre>
<p>Although it is not required to use the pydantic package to create model schemas, it is recommended. The pydantic
package is installed as a dependency of the ml_base package.</p>
<h2 id="using-the-modelmanager-class">Using the ModelManager Class</h2>
<p>The ModelManager class is provided to help manage model objects. It is a singleton class that is designed to enable
model instances to be instantiated once during the lifecycle of a process and accessed many times:</p>
<pre><code class="language-python">from ml_base.utilities import ModelManager


model_manager = ModelManager()
</code></pre>
<p>Because it is a singleton object, a reference to the same object is returned no matter how many times we instantiate it:</p>
<pre><code class="language-python">print(id(model_manager))

another_model_manager = ModelManager()

print(id(another_model_manager))
</code></pre>
<pre><code>4505980208
4505980208
</code></pre>
<p>You can add model instances to the ModelManager singleton by asking it to instantiate the model class:</p>
<pre><code class="language-python">model_manager.load_model(&quot;__main__.IrisModel&quot;)
</code></pre>
<p>The load_model() method is able to find the MLModel class that we defined above and instantiate it, after that it stores a reference to the instance internally.</p>
<p>The ModelManager is also able to save references to model instances that were instantiated in some other way by using the add_model() method:</p>
<pre><code class="language-python">another_iris_model = IrisModel()

try:
    model_manager.add_model(another_iris_model)
except ValueError as e:
    print(e)
</code></pre>
<pre><code>A model with the same qualified name is already in the ModelManager singleton.
</code></pre>
<p>In this case, the ModelManager did not save the instance of the IrisModel because we already had an instance of the model. The models are uniquely identified by their qualified name properties.</p>
<p>The ModelManager instance can list the models that it contains with the get_models() method, the details of the instance of IrisModel that we just created are returned:</p>
<pre><code class="language-python">model_manager.get_models()
</code></pre>
<pre><code>[{'display_name': 'Iris Model',
  'qualified_name': 'iris_model',
  'description': 'A model to predict the species of a flower based on its measurements.',
  'version': '1.0.0'}]
</code></pre>
<p>The ModelManager instance can return the metadata of any of the models. The metadata includes the input and output schemas as well:</p>
<pre><code class="language-python">model_manager.get_model_metadata(&quot;iris_model&quot;)
</code></pre>
<pre><code>{'display_name': 'Iris Model',
 'qualified_name': 'iris_model',
 'description': 'A model to predict the species of a flower based on its measurements.',
 'version': '1.0.0',
 'input_schema': {'title': 'ModelInput',
  'type': 'object',
  'properties': {'sepal_length': {'title': 'Sepal Length',
    'description': 'The length of the sepal of the flower.',
    'exclusiveMinimum': 5.0,
    'exclusiveMaximum': 8.0,
    'type': 'number'},
   'sepal_width': {'title': 'Sepal Width',
    'description': 'The width of the sepal of the flower.',
    'exclusiveMinimum': 2.0,
    'exclusiveMaximum': 6.0,
    'type': 'number'},
   'petal_length': {'title': 'Petal Length',
    'description': 'The length of the petal of the flower.',
    'exclusiveMinimum': 1.0,
    'exclusiveMaximum': 6.8,
    'type': 'number'},
   'petal_width': {'title': 'Petal Width',
    'description': 'The width of the petal of the flower.',
    'exclusiveMinimum': 0.0,
    'exclusiveMaximum': 3.0,
    'type': 'number'}},
  'required': ['sepal_length', 'sepal_width', 'petal_length', 'petal_width']},
 'output_schema': {'title': 'ModelOutput',
  'type': 'object',
  'properties': {'species': {'$ref': '#/definitions/Species'}},
  'required': ['species'],
  'definitions': {'Species': {'title': 'Species',
    'description': 'An enumeration.',
    'enum': ['Iris setosa', 'Iris versicolor', 'Iris virginica'],
    'type': 'string'}}}}
</code></pre>
<p>The ModelManager can return a reference to the instance of any model that it is holding:</p>
<pre><code class="language-python">iris_model = model_manager.get_model(&quot;iris_model&quot;)

print(iris_model.display_name)
</code></pre>
<pre><code>Iris Model
</code></pre>
<p>The instance is identified by the qualified name of the model.</p>
<p>Lastly, a model instance can be removed by calling the remove_model() method:</p>
<pre><code class="language-python">model_manager.remove_model(&quot;iris_model&quot;)

model_manager.get_models()
</code></pre>
<pre><code>[]
</code></pre>
<p>To clear the ModelManager instance, you can call the clear_instance() method:</p>
<pre><code class="language-python">model_manager.clear_instance()
</code></pre>
<p>To create a new singleton you have to instantiate the ModelManager again:</p>
<pre><code class="language-python">model_manager = ModelManager()
</code></pre>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="../decorator/" class="md-footer__link md-footer__link--next" aria-label="Next: Decorator Examples" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Decorator Examples
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2021, Brian Schmidt
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.092fa1f6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.e3b2bf44.min.js"></script>
      
    
  </body>
</html>